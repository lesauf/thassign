{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/CSEG/Desktop/thassign/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { EventEmitter } from '@angular/core';\nimport { combineLatest } from 'rxjs';\nimport { AssignmentCommon } from '@src/app/modules/assignments/components/assignment.common';\nimport { Assignment } from '@src/app/core/models/assignment/assignment.model';\nimport { AssignmentControlService } from '@src/app/modules/assignments/services/assignment-control.service';\nimport { tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@src/app/modules/assignments/services/assignment-control.service\";\nimport * as i2 from \"@src/app/modules/assignments/services/assignment.service\";\nimport * as i3 from \"@src/app/core/services/backend.service\";\nimport * as i4 from \"@src/app/core/services/part.service\";\nimport * as i5 from \"@src/app/modules/users/user.service\";\nimport * as i6 from \"@src/app/core/services/message.service\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"@src/app/core/services/setting.service\";\nimport * as i9 from \"@angular/material/legacy-snack-bar\";\nimport * as i10 from \"@ngx-translate/core\";\nimport * as i11 from \"@src/app/core/services/validation.service\";\nimport * as i12 from \"@angular/cdk/drag-drop\";\nimport * as i13 from \"@angular/common\";\nimport * as i14 from \"@angular/material/legacy-button\";\nimport * as i15 from \"@angular/material/icon\";\nimport * as i16 from \"@angular/material/legacy-tooltip\";\nimport * as i17 from \"@src/app/shared/components/loader/loader.component\";\nimport * as i18 from \"@src/app/modules/assignments/components/assignment/assignment.component\";\nimport * as i19 from \"@src/app/shared/pipes/translate-date.pipe\";\nconst _c0 = [\"printableArea\"];\nfunction AssignmentMidweekStudentsComponent_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loader\");\n  }\n}\nfunction AssignmentMidweekStudentsComponent_div_2_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function AssignmentMidweekStudentsComponent_div_2_div_2_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.setEditMode(false));\n    });\n    i0.ɵɵelementStart(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"undo\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"titlecase\");\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"button\", 10)(8, \"mat-icon\");\n    i0.ɵɵtext(9, \"save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"titlecase\");\n    i0.ɵɵpipe(12, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(5, 2, i0.ɵɵpipeBind1(6, 4, \"cancel\")), \" \");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(11, 6, i0.ɵɵpipeBind1(12, 8, \"save\")), \" \");\n  }\n}\nfunction AssignmentMidweekStudentsComponent_div_2_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function AssignmentMidweekStudentsComponent_div_2_ng_template_3_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r10.setEditMode(true));\n    });\n    i0.ɵɵelementStart(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"titlecase\");\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function AssignmentMidweekStudentsComponent_div_2_ng_template_3_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r12.saveAsPdf());\n    });\n    i0.ɵɵelementStart(8, \"mat-icon\");\n    i0.ɵɵtext(9, \"print\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"titlecase\");\n    i0.ɵɵpipe(12, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(5, 2, i0.ɵɵpipeBind1(6, 4, \"edit\")), \" \");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(11, 6, i0.ɵɵpipeBind1(12, 8, \"print\")), \" \");\n  }\n}\nfunction AssignmentMidweekStudentsComponent_div_2_div_9_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function AssignmentMidweekStudentsComponent_div_2_div_9_button_5_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r20 = i0.ɵɵnextContext();\n      const week_r13 = ctx_r20.$implicit;\n      const wIndex_r14 = ctx_r20.index;\n      const ctx_r19 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r19.addAssignment(week_r13, wIndex_r14));\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵelementStart(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"add_rounded\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r15 = i0.ɵɵnextContext(3);\n    i0.ɵɵpropertyInterpolate(\"matTooltip\", i0.ɵɵpipeBind1(1, 2, \"add-new-assignment\"));\n    i0.ɵɵproperty(\"disabled\", ctx_r15.studentsForm.disabled);\n  }\n}\nconst _c1 = function (a0, a1) {\n  return {\n    draggable: a0,\n    \"alternate-color\": a1\n  };\n};\nfunction AssignmentMidweekStudentsComponent_div_2_div_9_ng_container_7_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"app-assignment\", 19);\n    i0.ɵɵlistener(\"isRemoved\", function AssignmentMidweekStudentsComponent_div_2_div_9_ng_container_7_div_1_Template_app_assignment_isRemoved_1_listener($event) {\n      i0.ɵɵrestoreView(_r26);\n      const wIndex_r14 = i0.ɵɵnextContext(2).index;\n      const ctx_r24 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r24.removeAssignment($event, wIndex_r14));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const assignment_r23 = ctx.$implicit;\n    const wIndex_r14 = i0.ɵɵnextContext(2).index;\n    const ctx_r22 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(8, _c1, ctx_r22.isEditMode, assignment_r23.position % 2 !== 0))(\"cdkDragDisabled\", true);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"assignment\", assignment_r23)(\"isEditMode\", ctx_r22.isEditMode)(\"listOfParts\", ctx_r22.listOfParts)(\"assignableListByPart\", ctx_r22.assignableListByPart)(\"form\", ctx_r22.studentsForm)(\"wIndex\", wIndex_r14);\n  }\n}\nfunction AssignmentMidweekStudentsComponent_div_2_div_9_ng_container_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AssignmentMidweekStudentsComponent_div_2_div_9_ng_container_7_div_1_Template, 2, 11, \"div\", 17);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const wIndex_r14 = i0.ɵɵnextContext().index;\n    const ctx_r16 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r16.assignmentsByWeek[wIndex_r14]);\n  }\n}\nfunction AssignmentMidweekStudentsComponent_div_2_div_9_ng_template_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, \"no-assignment\"));\n  }\n}\nconst _c2 = function (a0) {\n  return {\n    \"assignments-list\": a0\n  };\n};\nfunction AssignmentMidweekStudentsComponent_div_2_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r30 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"h2\", 5);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"async\");\n    i0.ɵɵpipe(4, \"translateDate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, AssignmentMidweekStudentsComponent_div_2_div_9_button_5_Template, 4, 4, \"button\", 13);\n    i0.ɵɵelementStart(6, \"div\", 14);\n    i0.ɵɵlistener(\"cdkDropListDropped\", function AssignmentMidweekStudentsComponent_div_2_div_9_Template_div_cdkDropListDropped_6_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r30);\n      const wIndex_r14 = restoredCtx.index;\n      const ctx_r29 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r29.drop($event, wIndex_r14));\n    });\n    i0.ɵɵtemplate(7, AssignmentMidweekStudentsComponent_div_2_div_9_ng_container_7_Template, 2, 1, \"ng-container\", 1);\n    i0.ɵɵtemplate(8, AssignmentMidweekStudentsComponent_div_2_div_9_ng_template_8_Template, 3, 3, \"ng-template\", null, 15, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const week_r13 = ctx.$implicit;\n    const wIndex_r14 = ctx.index;\n    const _r17 = i0.ɵɵreference(9);\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(3, 6, i0.ɵɵpipeBind2(4, 8, week_r13, \"MMM-D\")), \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r7.isEditMode);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"cdkDropListData\", wIndex_r14);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(11, _c2, ctx_r7.isEditMode));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r7.assignmentsByWeek[wIndex_r14] == null ? null : ctx_r7.assignmentsByWeek[wIndex_r14].length)(\"ngIfElse\", _r17);\n  }\n}\nconst _c3 = function (a0, a1) {\n  return {\n    \"week-box-edit\": a0,\n    \"week-box-view\": a1\n  };\n};\nfunction AssignmentMidweekStudentsComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r32 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"form\", 2);\n    i0.ɵɵlistener(\"ngSubmit\", function AssignmentMidweekStudentsComponent_div_2_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r32);\n      const ctx_r31 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r31.onSubmit());\n    });\n    i0.ɵɵtemplate(2, AssignmentMidweekStudentsComponent_div_2_div_2_Template, 13, 10, \"div\", 3);\n    i0.ɵɵtemplate(3, AssignmentMidweekStudentsComponent_div_2_ng_template_3_Template, 13, 10, \"ng-template\", null, 4, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵtext(5, \" \\u00A0 \");\n    i0.ɵɵelementStart(6, \"div\", 5, 6)(8, \"div\", 7);\n    i0.ɵɵtemplate(9, AssignmentMidweekStudentsComponent_div_2_div_9_Template, 10, 13, \"div\", 8);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const _r4 = i0.ɵɵreference(4);\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r2.studentsForm);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isEditMode)(\"ngIfElse\", _r4);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(5, _c3, ctx_r2.isEditMode, !ctx_r2.isEditMode));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.weeks);\n  }\n}\n/**\r\n * Handle weekend assignments attributions\r\n * Chairman, speaker, Watchtower reader\r\n */\nexport class AssignmentMidweekStudentsComponent extends AssignmentCommon {\n  constructor(acs, assignmentService, backendService, partService, userService, messageService, formBuilder, settingService, _snackBar, _translate, validationService) {\n    super();\n    this.acs = acs;\n    this.assignmentService = assignmentService;\n    this.backendService = backendService;\n    this.partService = partService;\n    this.userService = userService;\n    this.messageService = messageService;\n    this.formBuilder = formBuilder;\n    this.settingService = settingService;\n    this._snackBar = _snackBar;\n    this._translate = _translate;\n    this.validationService = validationService;\n    /**\r\n     * By default the form is disabled\r\n     */\n    this.editMode = new EventEmitter();\n    // @Output()\n    // onSave: EventEmitter<Assignment[]> = new EventEmitter();\n    this.meetingName = 'midweek-students';\n    this.payLoad = '';\n    /**\r\n     * Display the Loading msg\r\n     */\n    this.loading = false;\n  }\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      yield _this.getParts();\n      // Pipe to the assignments observable the filtering\n      _this.data$ = combineLatest([_this.userService.data, _this.assignmentService.data]).subscribe( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* ([users, assignments]) {\n          if (_this.listOfParts === undefined) {\n            _this.listOfParts = yield _this.partService.getPartsByMeeting(_this.meetingName);\n          }\n          if (users !== null && assignments !== null) {\n            // Display form only when observables have started emitting\n            yield _this.initializeData();\n            // Load the assignments of the default month (current)\n            yield _this.initializeMonthData();\n            _this.assignmentService.getAssignmentsByPartsAndMonth(_this.month, _this.listOfParts);\n            // Get the observable of the filtered assignments\n            _this.pAssignments$ = _this.assignmentService.pAssignments.pipe(tap(pAssignments => {\n              _this.separateAssignmentsByWeek(pAssignments);\n              // Build the form\n              _this.prepareForm();\n            }));\n          }\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n  /**\r\n   * Called whenever a data bound property is changed\r\n   */\n  ngOnChanges(changes) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      yield _this2.initializeMonthData();\n      if (_this2.listOfParts) {\n        _this2.assignmentService.getAssignmentsByPartsAndMonth(_this2.month, _this2.listOfParts);\n      }\n      // Check if the previous form was in edit mode : useful ??\n      if (_this2.isEditMode) {\n        // alert('save first please');\n        changes.month.currentValue = changes.month.previousValue;\n      } else {}\n    })();\n  }\n  ngOnDestroy() {\n    // TODO: set an alert to inform the users that he is still in edit mode\n    // Emit edit mode event (to enable navigation)\n    // this.editMode.emit(false);\n    // this.assignmentService.pAssignments.unsubscribe();\n    this.data$.unsubscribe();\n  }\n  /**\r\n   * Separate the assignments of the month by week\r\n   */\n  separateAssignmentsByWeek(pAssignments) {\n    // this.assignmentsByWeek = [];\n    this.weeks.forEach((week, index) => {\n      this.assignmentsByWeek[index] = pAssignments.filter(ass => {\n        return week.start.toISODate() === ass.week.toISODate();\n      });\n    });\n  }\n  /**\r\n   * Prepare the form Data :\r\n   *   - Assignments by week\r\n   *   - FormGroup\r\n   *   - Subscribe to the form changes to update assignementsByWeek\r\n   */\n  prepareForm(assignmentsByWeek) {\n    delete this.studentsForm;\n    if (!assignmentsByWeek) {\n      assignmentsByWeek = this.assignmentsByWeek;\n    }\n    this.studentsForm = this.acs.toFormGroup(assignmentsByWeek);\n    this.studentsForm.valueChanges.subscribe(currentFormValues => {\n      this.updatePositions();\n    });\n  }\n  /**\r\n   * convert the form values to Assignment[] and update their positions\r\n   */\n  updatePositions() {\n    this.weeks.forEach((week, wIndex) => {\n      // convert the form data to Assignments Objects\n      this.assignmentsByWeek[wIndex] = this.assignmentService.createAssignment(this.studentsForm.value[wIndex]);\n    });\n  }\n  /**\r\n   * Insert a new assignment selector in the form\r\n   * With the subscription to the form valueChanges the assignmentsByWeek is\r\n   * automatically updated too\r\n   * @param week Week to insert at\r\n   * @param wIndex position within the week\r\n   */\n  addAssignment(week, wIndex) {\n    this.studentsForm.get([wIndex]).insert(this.assignmentsByWeek[wIndex].length, this.acs.toAssignmentControl(new Assignment({\n      week: week.start,\n      position: this.assignmentsByWeek[wIndex].length,\n      ownerId: this.backendService.getSignedInUser()._id\n      // part: null,\n      // assignee: null,\n      // assistant: null,\n    })));\n  }\n\n  removeAssignment(assignment, wIndex) {\n    this.studentsForm.get([wIndex]).removeAt(assignment.position);\n    // trigger valueChanges to update assignmentsByWeek\n    this.prepareForm();\n  }\n  drop(event, wIndex) {\n    const move = this.studentsForm.get([event.previousContainer.data]).get([event.previousIndex]);\n    this.studentsForm.get([event.previousContainer.data]).removeAt(event.previousIndex);\n    // Set the week\n    move.get('week').setValue(this.weeks[wIndex].start);\n    this.studentsForm.get([event.container.data]).insert(event.currentIndex, move);\n    // Update the positions in the form\n    this.prepareForm();\n  }\n  /**\r\n   * @todo extract the styles\r\n   */\n  saveAsPdf() {\n    // window.print();\n    const mywindow = window.open('', '', 'height=400,width=600');\n    this._translate.get('assignments').subscribe(pageTitle => {\n      const printContents = this.printable.nativeElement.innerHTML;\n      mywindow.document.write('<!DOCTYPE html><html><head><title>' + pageTitle + ': ' + this.month.toFormat('MMMM yyyy') + '</title>');\n      // Styling \n      mywindow.document.write('<style>' + 'body { font-size: 1.2em }' + '.assignment-box:not(last-child) { margin: 0 0 1em; }' + '.week-box-view { width: 80%; margin: 0 auto; }' + '.assignment-assignee { font-weight: bold; }' + '</style>');\n      /*optional stylesheet*/\n      mywindow.document.write('</head><body>');\n      mywindow.document.write(printContents);\n      mywindow.document.write('</body></html>');\n      mywindow.document.execCommand('print');\n      mywindow.close();\n    });\n  }\n  setEditMode(value) {\n    this.isEditMode = value;\n    this.editMode.emit(value);\n  }\n  onSubmit() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        // Convert the assignmentsByWeek values from the form to Assignment list\n        const a = [];\n        _this3.weeks.forEach((week, wIndex) => {\n          _this3.assignmentsByWeek[wIndex].forEach(assignment => a.push(assignment));\n        });\n        _this3.payLoad = JSON.stringify(a, null, 1);\n        _this3.loading = true;\n        yield _this3.assignmentService.saveAssignments(a, _this3.month, _this3.partService.getParts(), _this3.userService.getUsers());\n        _this3.loading = false;\n        _this3.setEditMode(false);\n      } catch (error) {\n        throw error;\n      }\n    })();\n  }\n  static #_ = this.ɵfac = function AssignmentMidweekStudentsComponent_Factory(t) {\n    return new (t || AssignmentMidweekStudentsComponent)(i0.ɵɵdirectiveInject(i1.AssignmentControlService), i0.ɵɵdirectiveInject(i2.AssignmentService), i0.ɵɵdirectiveInject(i3.BackendService), i0.ɵɵdirectiveInject(i4.PartService), i0.ɵɵdirectiveInject(i5.UserService), i0.ɵɵdirectiveInject(i6.MessageService), i0.ɵɵdirectiveInject(i7.UntypedFormBuilder), i0.ɵɵdirectiveInject(i8.SettingService), i0.ɵɵdirectiveInject(i9.MatLegacySnackBar), i0.ɵɵdirectiveInject(i10.TranslateService), i0.ɵɵdirectiveInject(i11.ValidationService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AssignmentMidweekStudentsComponent,\n    selectors: [[\"app-assignment-midweek-students\"]],\n    viewQuery: function AssignmentMidweekStudentsComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.printable = _t.first);\n      }\n    },\n    inputs: {\n      month: \"month\"\n    },\n    outputs: {\n      editMode: \"editMode\"\n    },\n    features: [i0.ɵɵProvidersFeature([AssignmentControlService]), i0.ɵɵInheritDefinitionFeature, i0.ɵɵNgOnChangesFeature],\n    decls: 4,\n    vars: 4,\n    consts: [[\"loading\", \"\"], [4, \"ngIf\", \"ngIfElse\"], [\"fxLayout\", \"column\", \"fxLayoutAlign\", \"space-between stretch\", 3, \"formGroup\", \"ngSubmit\"], [\"fxFlex\", \"\", 4, \"ngIf\", \"ngIfElse\"], [\"viewButtons\", \"\"], [\"fxFlex\", \"\"], [\"printableArea\", \"\"], [\"cdkDropListGroup\", \"\", \"fxLayout\", \"column\", \"fxLayoutAlign\", \"space-between center\", 3, \"ngClass\"], [\"fxFlex\", \"\", \"fxFill\", \"\", \"fxLayout\", \"row wrap\", \"fxLayoutAlign\", \"space-around start\", \"class\", \"assignments-container\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"reset\", \"mat-raised-button\", \"\", 1, \"mat-primary\", 3, \"click\"], [\"type\", \"submit\", \"mat-raised-button\", \"\", 1, \"mat-primary\"], [\"type\", \"button\", \"mat-raised-button\", \"\", 1, \"mat-primary\", 3, \"click\"], [\"fxFlex\", \"\", \"fxFill\", \"\", \"fxLayout\", \"row wrap\", \"fxLayoutAlign\", \"space-around start\", 1, \"assignments-container\"], [\"type\", \"button\", \"fxFlex\", \"nogrow\", \"mat-raised-button\", \"\", 3, \"matTooltip\", \"disabled\", \"click\", 4, \"ngIf\"], [\"fxFlex\", \"100\", \"cdkDropList\", \"\", 3, \"cdkDropListData\", \"ngClass\", \"cdkDropListDropped\"], [\"noAssignment\", \"\"], [\"type\", \"button\", \"fxFlex\", \"nogrow\", \"mat-raised-button\", \"\", 3, \"matTooltip\", \"disabled\", \"click\"], [\"class\", \"assignment-box\", \"cdkDrag\", \"\", 3, \"ngClass\", \"cdkDragDisabled\", 4, \"ngFor\", \"ngForOf\"], [\"cdkDrag\", \"\", 1, \"assignment-box\", 3, \"ngClass\", \"cdkDragDisabled\"], [3, \"assignment\", \"isEditMode\", \"listOfParts\", \"assignableListByPart\", \"form\", \"wIndex\", \"isRemoved\"]],\n    template: function AssignmentMidweekStudentsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AssignmentMidweekStudentsComponent_ng_template_0_Template, 1, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(2, AssignmentMidweekStudentsComponent_div_2_Template, 10, 8, \"div\", 1);\n        i0.ɵɵpipe(3, \"async\");\n      }\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(1);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(3, 2, ctx.pAssignments$))(\"ngIfElse\", _r0);\n      }\n    },\n    dependencies: [i12.CdkDropList, i12.CdkDropListGroup, i12.CdkDrag, i13.NgClass, i13.NgForOf, i13.NgIf, i7.ɵNgNoValidate, i7.NgControlStatusGroup, i14.MatLegacyButton, i15.MatIcon, i16.MatLegacyTooltip, i7.FormGroupDirective, i17.LoaderComponent, i18.AssignmentComponent, i13.AsyncPipe, i13.TitleCasePipe, i19.TranslateDatePipe],\n    styles: [\".week-box-edit[_ngcontent-%COMP%]   .alternate-color[_ngcontent-%COMP%] {\\n  border-top: 1px solid #444444;\\n}\\n\\n.week-box-view[_ngcontent-%COMP%] {\\n  background-color: white;\\n  padding: 1em;\\n  color: #555555;\\n}\\n\\nh2[_ngcontent-%COMP%] {\\n  margin: 0;\\n  font-size: 1.2em;\\n}\\n\\n.assignments-list[_ngcontent-%COMP%] {\\n  min-height: 20px;\\n  border-radius: 4px;\\n  overflow: hidden;\\n}\\n\\n.cdk-drag-preview[_ngcontent-%COMP%] {\\n  border-radius: 4px;\\n  box-shadow: 0 5px 5px -3px rgba(0, 0, 0, 0.2), 0 8px 10px 1px rgba(0, 0, 0, 0.14), 0 3px 14px 2px rgba(0, 0, 0, 0.12);\\n}\\n\\n.cdk-drag-placeholder[_ngcontent-%COMP%] {\\n  opacity: 0;\\n}\\n\\n.cdk-drag-animating[_ngcontent-%COMP%] {\\n  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);\\n}\\n\\n.assignment-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .assignment-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder) {\\n  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2lnbm1lbnQtbWlkd2Vlay1zdHVkZW50cy5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFRTtFQUNFLDZCQUFBO0FBREo7O0FBS0E7RUFDRSx1QkFBQTtFQUNBLFlBQUE7RUFDQSxjQUFBO0FBRkY7O0FBUUE7RUFDRSxTQUFBO0VBQ0EsZ0JBQUE7QUFMRjs7QUFRQTtFQUVFLGdCQUFBO0VBQ0Esa0JBQUE7RUFDQSxnQkFBQTtBQU5GOztBQWdCQTtFQUNFLGtCQUFBO0VBQ0EscUhBQUE7QUFiRjs7QUFpQkE7RUFDRSxVQUFBO0FBZEY7O0FBaUJBO0VBQ0Usc0RBQUE7QUFkRjs7QUFpQkE7RUFFRSxzREFBQTtBQWZGIiwiZmlsZSI6ImFzc2lnbm1lbnQtbWlkd2Vlay1zdHVkZW50cy5jb21wb25lbnQuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi53ZWVrLWJveC1lZGl0IHtcclxuICAvLyBTdHlsZXMgZm9yIHRoZSBmb3JtXHJcbiAgLmFsdGVybmF0ZS1jb2xvciB7XHJcbiAgICBib3JkZXItdG9wOiAxcHggc29saWQgIzQ0NDQ0NDtcclxuICB9XHJcbn1cclxuXHJcbi53ZWVrLWJveC12aWV3IHtcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTtcclxuICBwYWRkaW5nOiAxZW07XHJcbiAgY29sb3I6ICM1NTU1NTU7XHJcbn1cclxuXHJcbi5hc3NpZ25tZW50cy1jb250YWluZXIge1xyXG59XHJcblxyXG5oMiB7XHJcbiAgbWFyZ2luOiAwO1xyXG4gIGZvbnQtc2l6ZTogMS4yZW07XHJcbn1cclxuXHJcbi5hc3NpZ25tZW50cy1saXN0IHtcclxuICAvLyBib3JkZXI6IGRhc2hlZCAxcHggI2NjYztcclxuICBtaW4taGVpZ2h0OiAyMHB4O1xyXG4gIGJvcmRlci1yYWRpdXM6IDRweDtcclxuICBvdmVyZmxvdzogaGlkZGVuO1xyXG59XHJcblxyXG4uYXNzaWdubWVudC1ib3gge1xyXG59XHJcblxyXG4uZHJhZ2dhYmxlIHtcclxuICAvLyBjdXJzb3I6IG1vdmU7XHJcbn1cclxuXHJcbi5jZGstZHJhZy1wcmV2aWV3IHtcclxuICBib3JkZXItcmFkaXVzOiA0cHg7XHJcbiAgYm94LXNoYWRvdzogMCA1cHggNXB4IC0zcHggcmdiYSgwLCAwLCAwLCAwLjIpLFxyXG4gICAgMCA4cHggMTBweCAxcHggcmdiYSgwLCAwLCAwLCAwLjE0KSwgMCAzcHggMTRweCAycHggcmdiYSgwLCAwLCAwLCAwLjEyKTtcclxufVxyXG5cclxuLmNkay1kcmFnLXBsYWNlaG9sZGVyIHtcclxuICBvcGFjaXR5OiAwO1xyXG59XHJcblxyXG4uY2RrLWRyYWctYW5pbWF0aW5nIHtcclxuICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMjUwbXMgY3ViaWMtYmV6aWVyKDAsIDAsIDAuMiwgMSk7XHJcbn1cclxuXHJcbi5hc3NpZ25tZW50LWxpc3QuY2RrLWRyb3AtbGlzdC1kcmFnZ2luZ1xyXG4gIC5hc3NpZ25tZW50LWJveDpub3QoLmNkay1kcmFnLXBsYWNlaG9sZGVyKSB7XHJcbiAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDI1MG1zIGN1YmljLWJlemllcigwLCAwLCAwLjIsIDEpO1xyXG59XHJcbiJdfQ== */\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvbW9kdWxlcy9hc3NpZ25tZW50cy9jb21wb25lbnRzL2Fzc2lnbm1lbnQtbWlkd2Vlay1zdHVkZW50cy9hc3NpZ25tZW50LW1pZHdlZWstc3R1ZGVudHMuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUU7RUFDRSw2QkFBQTtBQURKOztBQUtBO0VBQ0UsdUJBQUE7RUFDQSxZQUFBO0VBQ0EsY0FBQTtBQUZGOztBQVFBO0VBQ0UsU0FBQTtFQUNBLGdCQUFBO0FBTEY7O0FBUUE7RUFFRSxnQkFBQTtFQUNBLGtCQUFBO0VBQ0EsZ0JBQUE7QUFORjs7QUFnQkE7RUFDRSxrQkFBQTtFQUNBLHFIQUFBO0FBYkY7O0FBaUJBO0VBQ0UsVUFBQTtBQWRGOztBQWlCQTtFQUNFLHNEQUFBO0FBZEY7O0FBaUJBO0VBRUUsc0RBQUE7QUFmRjtBQUNBLGc3REFBZzdEIiwic291cmNlc0NvbnRlbnQiOlsiLndlZWstYm94LWVkaXQge1xyXG4gIC8vIFN0eWxlcyBmb3IgdGhlIGZvcm1cclxuICAuYWx0ZXJuYXRlLWNvbG9yIHtcclxuICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjNDQ0NDQ0O1xyXG4gIH1cclxufVxyXG5cclxuLndlZWstYm94LXZpZXcge1xyXG4gIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xyXG4gIHBhZGRpbmc6IDFlbTtcclxuICBjb2xvcjogIzU1NTU1NTtcclxufVxyXG5cclxuLmFzc2lnbm1lbnRzLWNvbnRhaW5lciB7XHJcbn1cclxuXHJcbmgyIHtcclxuICBtYXJnaW46IDA7XHJcbiAgZm9udC1zaXplOiAxLjJlbTtcclxufVxyXG5cclxuLmFzc2lnbm1lbnRzLWxpc3Qge1xyXG4gIC8vIGJvcmRlcjogZGFzaGVkIDFweCAjY2NjO1xyXG4gIG1pbi1oZWlnaHQ6IDIwcHg7XHJcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xyXG4gIG92ZXJmbG93OiBoaWRkZW47XHJcbn1cclxuXHJcbi5hc3NpZ25tZW50LWJveCB7XHJcbn1cclxuXHJcbi5kcmFnZ2FibGUge1xyXG4gIC8vIGN1cnNvcjogbW92ZTtcclxufVxyXG5cclxuLmNkay1kcmFnLXByZXZpZXcge1xyXG4gIGJvcmRlci1yYWRpdXM6IDRweDtcclxuICBib3gtc2hhZG93OiAwIDVweCA1cHggLTNweCByZ2JhKDAsIDAsIDAsIDAuMiksXHJcbiAgICAwIDhweCAxMHB4IDFweCByZ2JhKDAsIDAsIDAsIDAuMTQpLCAwIDNweCAxNHB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMTIpO1xyXG59XHJcblxyXG4uY2RrLWRyYWctcGxhY2Vob2xkZXIge1xyXG4gIG9wYWNpdHk6IDA7XHJcbn1cclxuXHJcbi5jZGstZHJhZy1hbmltYXRpbmcge1xyXG4gIHRyYW5zaXRpb246IHRyYW5zZm9ybSAyNTBtcyBjdWJpYy1iZXppZXIoMCwgMCwgMC4yLCAxKTtcclxufVxyXG5cclxuLmFzc2lnbm1lbnQtbGlzdC5jZGstZHJvcC1saXN0LWRyYWdnaW5nXHJcbiAgLmFzc2lnbm1lbnQtYm94Om5vdCguY2RrLWRyYWctcGxhY2Vob2xkZXIpIHtcclxuICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMjUwbXMgY3ViaWMtYmV6aWVyKDAsIDAsIDAuMiwgMSk7XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}","map":{"version":3,"names":["EventEmitter","combineLatest","AssignmentCommon","Assignment","AssignmentControlService","tap","i0","ɵɵelement","ɵɵelementStart","ɵɵlistener","AssignmentMidweekStudentsComponent_div_2_div_2_Template_button_click_1_listener","ɵɵrestoreView","_r9","ctx_r8","ɵɵnextContext","ɵɵresetView","setEditMode","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate1","ɵɵpipeBind1","AssignmentMidweekStudentsComponent_div_2_ng_template_3_Template_button_click_1_listener","_r11","ctx_r10","AssignmentMidweekStudentsComponent_div_2_ng_template_3_Template_button_click_7_listener","ctx_r12","saveAsPdf","AssignmentMidweekStudentsComponent_div_2_div_9_button_5_Template_button_click_0_listener","_r21","ctx_r20","week_r13","$implicit","wIndex_r14","index","ctx_r19","addAssignment","ɵɵpropertyInterpolate","ɵɵproperty","ctx_r15","studentsForm","disabled","AssignmentMidweekStudentsComponent_div_2_div_9_ng_container_7_div_1_Template_app_assignment_isRemoved_1_listener","$event","_r26","ctx_r24","removeAssignment","ɵɵpureFunction2","_c1","ctx_r22","isEditMode","assignment_r23","position","listOfParts","assignableListByPart","ɵɵelementContainerStart","ɵɵtemplate","AssignmentMidweekStudentsComponent_div_2_div_9_ng_container_7_div_1_Template","ɵɵelementContainerEnd","ctx_r16","assignmentsByWeek","ɵɵtextInterpolate","AssignmentMidweekStudentsComponent_div_2_div_9_button_5_Template","AssignmentMidweekStudentsComponent_div_2_div_9_Template_div_cdkDropListDropped_6_listener","restoredCtx","_r30","ctx_r29","drop","AssignmentMidweekStudentsComponent_div_2_div_9_ng_container_7_Template","AssignmentMidweekStudentsComponent_div_2_div_9_ng_template_8_Template","ɵɵtemplateRefExtractor","ɵɵpipeBind2","ctx_r7","ɵɵpureFunction1","_c2","length","_r17","AssignmentMidweekStudentsComponent_div_2_Template_form_ngSubmit_1_listener","_r32","ctx_r31","onSubmit","AssignmentMidweekStudentsComponent_div_2_div_2_Template","AssignmentMidweekStudentsComponent_div_2_ng_template_3_Template","AssignmentMidweekStudentsComponent_div_2_div_9_Template","ctx_r2","_r4","_c3","weeks","AssignmentMidweekStudentsComponent","constructor","acs","assignmentService","backendService","partService","userService","messageService","formBuilder","settingService","_snackBar","_translate","validationService","editMode","meetingName","payLoad","loading","ngOnInit","_this","_asyncToGenerator","getParts","data$","data","subscribe","_ref","users","assignments","undefined","getPartsByMeeting","initializeData","initializeMonthData","getAssignmentsByPartsAndMonth","month","pAssignments$","pAssignments","pipe","separateAssignmentsByWeek","prepareForm","_x","apply","arguments","ngOnChanges","changes","_this2","currentValue","previousValue","ngOnDestroy","unsubscribe","forEach","week","filter","ass","start","toISODate","toFormGroup","valueChanges","currentFormValues","updatePositions","wIndex","createAssignment","value","get","insert","toAssignmentControl","ownerId","getSignedInUser","_id","assignment","removeAt","event","move","previousContainer","previousIndex","setValue","container","currentIndex","mywindow","window","open","pageTitle","printContents","printable","nativeElement","innerHTML","document","write","toFormat","execCommand","close","emit","_this3","a","push","JSON","stringify","saveAssignments","getUsers","error","_","ɵɵdirectiveInject","i1","i2","AssignmentService","i3","BackendService","i4","PartService","i5","UserService","i6","MessageService","i7","UntypedFormBuilder","i8","SettingService","i9","MatLegacySnackBar","i10","TranslateService","i11","ValidationService","_2","selectors","viewQuery","AssignmentMidweekStudentsComponent_Query","rf","ctx","ɵɵInheritDefinitionFeature","ɵɵNgOnChangesFeature","decls","vars","consts","template","AssignmentMidweekStudentsComponent_Template","AssignmentMidweekStudentsComponent_ng_template_0_Template","AssignmentMidweekStudentsComponent_div_2_Template","_r0"],"sources":["C:\\Users\\CSEG\\Desktop\\thassign\\src\\app\\modules\\assignments\\components\\assignment-midweek-students\\assignment-midweek-students.component.ts","C:\\Users\\CSEG\\Desktop\\thassign\\src\\app\\modules\\assignments\\components\\assignment-midweek-students\\assignment-midweek-students.component.html"],"sourcesContent":["import {\r\n  Component,\r\n  EventEmitter,\r\n  OnChanges,\r\n  OnInit,\r\n  Input,\r\n  Output,\r\n  SimpleChanges,\r\n  OnDestroy,\r\n  ViewChild,\r\n  ElementRef,\r\n} from '@angular/core';\r\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\r\nimport {\r\n  UntypedFormArray,\r\n  FormControl,\r\n  UntypedFormGroup,\r\n  Validators,\r\n  UntypedFormBuilder,\r\n} from '@angular/forms';\r\nimport { MatLegacySnackBar as MatSnackBar } from '@angular/material/legacy-snack-bar';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { DateTime, Interval } from 'luxon';\r\nimport { combineLatest, forkJoin, merge, Observable, Subscription, zip } from 'rxjs';\r\n\r\nimport { AssignmentCommon } from '@src/app/modules/assignments/components/assignment.common';\r\nimport { AssignmentService } from '@src/app/modules/assignments/services/assignment.service';\r\nimport { AuthService } from '@src/app/modules/auth/auth.service';\r\nimport { MessageService } from '@src/app/core/services/message.service';\r\nimport { PartService } from '@src/app/core/services/part.service';\r\nimport { SettingService } from '@src/app/core/services/setting.service';\r\nimport { UserService } from '@src/app/modules/users/user.service';\r\nimport { ValidationService } from '@src/app/core/services/validation.service';\r\nimport { Assignment } from '@src/app/core/models/assignment/assignment.model';\r\nimport { Part } from '@src/app/core/models/part/part.model';\r\nimport { AssignmentControlService } from '@src/app/modules/assignments/services/assignment-control.service';\r\nimport { BackendService } from '@src/app/core/services/backend.service';\r\nimport { map, tap } from 'rxjs/operators';\r\nimport { User } from '@src/app/core/models/user/user.model';\r\n\r\n/**\r\n * Handle weekend assignments attributions\r\n * Chairman, speaker, Watchtower reader\r\n */\r\n@Component({\r\n  selector: 'app-assignment-midweek-students',\r\n  templateUrl: './assignment-midweek-students.component.html',\r\n  styleUrls: ['./assignment-midweek-students.component.scss'],\r\n  providers: [AssignmentControlService],\r\n})\r\nexport class AssignmentMidweekStudentsComponent\r\n  extends AssignmentCommon\r\n  implements OnInit, OnChanges, OnDestroy {\r\n  @Input()\r\n  /**\r\n   * Starting day of the month of this program\r\n   */\r\n  month: DateTime;\r\n\r\n  /**\r\n   * By default the form is disabled\r\n   */\r\n  @Output()\r\n  editMode: EventEmitter<any> = new EventEmitter();\r\n\r\n  @ViewChild('printableArea')\r\n  printable: ElementRef;\r\n\r\n  // @Output()\r\n  // onSave: EventEmitter<Assignment[]> = new EventEmitter();\r\n\r\n  meetingName = 'midweek-students';\r\n\r\n  /**\r\n   * paginated Assignments\r\n   */\r\n  pAssignments$: Observable<Assignment[]>;\r\n\r\n  /**\r\n   * Subscription to observable created by combining\r\n   * Users and Assignments observables\r\n   */\r\n  data$: Subscription;\r\n\r\n  studentsForm: UntypedFormGroup;\r\n\r\n  payLoad = '';\r\n\r\n  /**\r\n   * Display the Loading msg\r\n   */\r\n  loading = false;\r\n\r\n  constructor(\r\n    private acs: AssignmentControlService,\r\n    protected assignmentService: AssignmentService,\r\n    protected backendService: BackendService,\r\n    protected partService: PartService,\r\n    protected userService: UserService,\r\n    protected messageService: MessageService,\r\n    protected formBuilder: UntypedFormBuilder,\r\n    protected settingService: SettingService,\r\n    protected _snackBar: MatSnackBar,\r\n    protected _translate: TranslateService,\r\n    protected validationService: ValidationService\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  async ngOnInit() {\r\n    await this.getParts();\r\n\r\n    // Pipe to the assignments observable the filtering\r\n    this.data$ = combineLatest([\r\n      this.userService.data,\r\n      this.assignmentService.data,\r\n    ]).subscribe(async ([users, assignments]) => {\r\n      if (this.listOfParts === undefined) {\r\n        this.listOfParts = await this.partService.getPartsByMeeting(\r\n          this.meetingName\r\n        );\r\n      }\r\n\r\n      if (users !== null && assignments !== null) {\r\n        // Display form only when observables have started emitting\r\n        await this.initializeData();\r\n\r\n        // Load the assignments of the default month (current)\r\n        await this.initializeMonthData();\r\n\r\n        this.assignmentService.getAssignmentsByPartsAndMonth(\r\n          this.month,\r\n          this.listOfParts\r\n        );\r\n\r\n        // Get the observable of the filtered assignments\r\n        this.pAssignments$ = this.assignmentService.pAssignments.pipe(\r\n          tap((pAssignments) => {\r\n            this.separateAssignmentsByWeek(pAssignments);\r\n\r\n            // Build the form\r\n            this.prepareForm();\r\n          })\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Called whenever a data bound property is changed\r\n   */\r\n  async ngOnChanges(changes: SimpleChanges) {\r\n    await this.initializeMonthData();\r\n    \r\n    if (this.listOfParts) {\r\n      this.assignmentService.getAssignmentsByPartsAndMonth(\r\n        this.month,\r\n        this.listOfParts\r\n      );\r\n    }\r\n\r\n    // Check if the previous form was in edit mode : useful ??\r\n    if (this.isEditMode) {\r\n      // alert('save first please');\r\n      changes.month.currentValue = changes.month.previousValue;\r\n    } else {\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    // TODO: set an alert to inform the users that he is still in edit mode\r\n    // Emit edit mode event (to enable navigation)\r\n    // this.editMode.emit(false);\r\n    // this.assignmentService.pAssignments.unsubscribe();\r\n    this.data$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Separate the assignments of the month by week\r\n   */\r\n  separateAssignmentsByWeek(pAssignments: Assignment[]) {\r\n    // this.assignmentsByWeek = [];\r\n\r\n    this.weeks.forEach((week, index) => {\r\n      this.assignmentsByWeek[index] = pAssignments.filter((ass) => {\r\n        return week.start.toISODate() === ass.week.toISODate();\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Prepare the form Data :\r\n   *   - Assignments by week\r\n   *   - FormGroup\r\n   *   - Subscribe to the form changes to update assignementsByWeek\r\n   */\r\n  prepareForm(assignmentsByWeek?: Assignment[][]) {\r\n    delete this.studentsForm;\r\n\r\n    if (!assignmentsByWeek) {\r\n      assignmentsByWeek = this.assignmentsByWeek;\r\n    }\r\n\r\n    this.studentsForm = this.acs.toFormGroup(assignmentsByWeek);\r\n\r\n    this.studentsForm.valueChanges.subscribe((currentFormValues) => {\r\n      this.updatePositions();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * convert the form values to Assignment[] and update their positions\r\n   */\r\n  updatePositions() {\r\n    this.weeks.forEach((week, wIndex) => {\r\n      // convert the form data to Assignments Objects\r\n      this.assignmentsByWeek[wIndex] = this.assignmentService.createAssignment(\r\n        this.studentsForm.value[wIndex]\r\n      ) as Assignment[];\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Insert a new assignment selector in the form\r\n   * With the subscription to the form valueChanges the assignmentsByWeek is\r\n   * automatically updated too\r\n   * @param week Week to insert at\r\n   * @param wIndex position within the week\r\n   */\r\n  addAssignment(week: Interval, wIndex: string) {\r\n    (this.studentsForm.get([wIndex]) as UntypedFormArray).insert(\r\n      this.assignmentsByWeek[wIndex].length,\r\n      this.acs.toAssignmentControl(\r\n        new Assignment({\r\n          week: week.start,\r\n          position: this.assignmentsByWeek[wIndex].length,\r\n          ownerId: this.backendService.getSignedInUser()._id,\r\n          // part: null,\r\n          // assignee: null,\r\n          // assistant: null,\r\n        })\r\n      )\r\n    );\r\n  }\r\n\r\n  removeAssignment(assignment: Assignment, wIndex: string) {\r\n    (this.studentsForm.get([wIndex]) as UntypedFormArray).removeAt(\r\n      assignment.position\r\n    );\r\n    // trigger valueChanges to update assignmentsByWeek\r\n\r\n    this.prepareForm();\r\n  }\r\n\r\n  drop(event: CdkDragDrop<number>, wIndex: number) {\r\n    const move = (this.studentsForm.get([\r\n      event.previousContainer.data,\r\n    ]) as UntypedFormArray).get([event.previousIndex]);\r\n\r\n    (this.studentsForm.get([\r\n      event.previousContainer.data,\r\n    ]) as UntypedFormArray).removeAt(event.previousIndex);\r\n\r\n    // Set the week\r\n    move.get('week').setValue(this.weeks[wIndex].start);\r\n\r\n    (this.studentsForm.get([event.container.data]) as UntypedFormArray).insert(\r\n      event.currentIndex,\r\n      move\r\n    );\r\n\r\n    // Update the positions in the form\r\n    this.prepareForm();\r\n  }\r\n\r\n  /**\r\n   * @todo extract the styles\r\n   */\r\n  saveAsPdf() {\r\n    // window.print();\r\n\r\n    const mywindow = window.open('', '', 'height=400,width=600');\r\n\r\n    this._translate.get('assignments').subscribe((pageTitle) => {\r\n      const printContents = this.printable.nativeElement.innerHTML;\r\n\r\n      mywindow.document.write(\r\n        '<!DOCTYPE html><html><head><title>' +\r\n          pageTitle +\r\n          ': ' +\r\n          this.month.toFormat('MMMM yyyy') +\r\n          '</title>'\r\n      );\r\n      // Styling \r\n      mywindow.document.write(\r\n        '<style>' +\r\n          'body { font-size: 1.2em }' +\r\n          '.assignment-box:not(last-child) { margin: 0 0 1em; }' +\r\n          '.week-box-view { width: 80%; margin: 0 auto; }' +\r\n          '.assignment-assignee { font-weight: bold; }' +\r\n          '</style>'\r\n      );\r\n      /*optional stylesheet*/\r\n      mywindow.document.write('</head><body>');\r\n      mywindow.document.write(printContents);\r\n      mywindow.document.write('</body></html>');\r\n      \r\n      mywindow.document.execCommand('print');\r\n      mywindow.close();\r\n    });\r\n  }\r\n\r\n  setEditMode(value: boolean) {\r\n    this.isEditMode = value;\r\n\r\n    this.editMode.emit(value);\r\n  }\r\n\r\n  async onSubmit() {\r\n    try {\r\n      // Convert the assignmentsByWeek values from the form to Assignment list\r\n      const a = [];\r\n      this.weeks.forEach((week, wIndex) => {\r\n        this.assignmentsByWeek[wIndex].forEach((assignment) =>\r\n          a.push(assignment)\r\n        );\r\n      });\r\n\r\n      this.payLoad = JSON.stringify(a, null, 1);\r\n\r\n      this.loading = true;\r\n      await this.assignmentService.saveAssignments(\r\n        a,\r\n        this.month,\r\n        this.partService.getParts(),\r\n        this.userService.getUsers()\r\n      );\r\n\r\n      this.loading = false;\r\n      this.setEditMode(false);\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Populate form, refresh and disable it\r\n   */\r\n  // async populateForm() {\r\n  //   // Refresh the list of users (to have their latests assignments up to date)\r\n  //   // this.getPartsAssignableList();\r\n\r\n  //   // Get stored values\r\n  //   const midweekAssignments = await this.assignmentService.getAssignmentsByMeetingAndMonth(\r\n  //     'midweek-students',\r\n  //     this.month\r\n  //   );\r\n\r\n  //   // Populate form with stored values if there are\r\n  //   const weekForms = this.monthForm;\r\n\r\n  //   // weekForms.controls.forEach((studentsForm: FormGroup, i) => {\r\n  //   //   this.listOfPartsByWeek[i].forEach((partName, partIndex) => {\r\n  //   //     // const partName = partNameFull.substr(0, partNameFull.indexOf('-'));\r\n\r\n  //   //     const week = studentsForm.get([partIndex]).value.week;\r\n  //   //     const position = studentsForm.get([partIndex]).value.position;\r\n\r\n  //   //     if (midweekAssignments[week] !== undefined) {\r\n  //   //       const partNameFull = this[partName + 'Part'].name;\r\n  //   //       const partNameFullWithPosition = partNameFull + '-' + position;\r\n\r\n  //   //       if (\r\n  //   //         midweekAssignments[week][partNameFullWithPosition] !== undefined\r\n  //   //       ) {\r\n  //   //         // Type casting to remove TS errors\r\n  //   //         ((this.monthForm.get('weeks') as FormArray).at(\r\n  //   //           i\r\n  //   //         ) as FormGroup).controls[partIndex].patchValue(\r\n  //   //           midweekAssignments[week][partNameFullWithPosition]\r\n  //   //         );\r\n  //   //       }\r\n  //   //     }\r\n  //   //   });\r\n  //   // });\r\n  // }\r\n\r\n  // async saveForm(formData) {\r\n  //   try {\r\n  //     await this.assignmentService.upsertAssignments(\r\n  //       formData,\r\n  //       this.month.toFormat(this.settingService.getDateFormat('parseMonth'))\r\n  //     );\r\n\r\n  //     this._translate.get('assignment-save-success').subscribe((message) => {\r\n  //       this.messageService.presentToast(message);\r\n  //     });\r\n  //   } catch (error) {\r\n  //     throw error;\r\n  //   }\r\n  // }\r\n}\r\n","<ng-template #loading>\r\n  <app-loader></app-loader>\r\n</ng-template>\r\n\r\n<!-- <pre *ngIf=\"pAssignments$ | async as pAssignments\"> {{ prettify(pAssignments) }}</pre> -->\r\n\r\n<div *ngIf=\"pAssignments$ | async; else loading\">\r\n  <form\r\n    (ngSubmit)=\"onSubmit()\"\r\n    [formGroup]=\"studentsForm\"\r\n    fxLayout=\"column\"\r\n    fxLayoutAlign=\"space-between stretch\"\r\n  >\r\n    <!-- FORM BUTTONS-->\r\n    <div *ngIf=\"isEditMode; else viewButtons\" fxFlex>\r\n      <!-- \r\n      fxLayout=\"row\" fxLayoutAlign=\"space-around center\" -->\r\n      <button\r\n        type=\"reset\"\r\n        mat-raised-button\r\n        class=\"mat-primary\"\r\n        (click)=\"setEditMode(false)\"\r\n      >\r\n        <mat-icon>undo</mat-icon>\r\n        {{ \"cancel\" | translate | titlecase }}\r\n      </button>\r\n\r\n      <button type=\"submit\" mat-raised-button class=\"mat-primary\">\r\n        <mat-icon>save</mat-icon>\r\n        {{ \"save\" | translate | titlecase }}\r\n      </button>\r\n    </div>\r\n\r\n    <!-- PRINT BUTTONS -->\r\n    <ng-template #viewButtons>\r\n      <div fxFlex>\r\n        <button\r\n          type=\"button\"\r\n          mat-raised-button\r\n          class=\"mat-primary\"\r\n          (click)=\"setEditMode(true)\"\r\n        >\r\n          <mat-icon>edit</mat-icon>\r\n          {{ \"edit\" | translate | titlecase }}\r\n        </button>\r\n\r\n        <button\r\n          type=\"button\"\r\n          mat-raised-button\r\n          class=\"mat-primary\"\r\n          (click)=\"saveAsPdf()\"\r\n        >\r\n          <mat-icon>print</mat-icon>\r\n          {{ \"print\" | translate | titlecase }}\r\n        </button>\r\n      </div>\r\n    </ng-template>\r\n    &nbsp;\r\n\r\n    <!-- WEEKS -->\r\n    <div fxFlex #printableArea>\r\n      <div\r\n        [ngClass]=\"{\r\n          'week-box-edit': isEditMode,\r\n          'week-box-view': !isEditMode\r\n        }\"\r\n        cdkDropListGroup\r\n        fxLayout=\"column\"\r\n        fxLayoutAlign=\"space-between center\"\r\n      >\r\n        <div\r\n          *ngFor=\"let week of weeks; index as wIndex\"\r\n          fxFlex\r\n          fxFill\r\n          fxLayout=\"row wrap\"\r\n          fxLayoutAlign=\"space-around start\"\r\n          class=\"assignments-container\"\r\n        >\r\n          <h2 fxFlex>\r\n            {{ week | translateDate: \"MMM-D\" | async }}\r\n          </h2>\r\n          <button\r\n            *ngIf=\"isEditMode\"\r\n            type=\"button\"\r\n            fxFlex=\"nogrow\"\r\n            mat-raised-button\r\n            matTooltip=\"{{ 'add-new-assignment' | translate }}\"\r\n            [disabled]=\"studentsForm.disabled\"\r\n            (click)=\"addAssignment(week, wIndex)\"\r\n          >\r\n            <mat-icon>add_rounded</mat-icon>\r\n          </button>\r\n\r\n          <!--<div >-->\r\n          <div\r\n            fxFlex=\"100\"\r\n            cdkDropList\r\n            cdkDropListData=\"{{ wIndex }}\"\r\n            [ngClass]=\"{ 'assignments-list': isEditMode }\"\r\n            (cdkDropListDropped)=\"drop($event, wIndex)\"\r\n          >\r\n            <ng-container\r\n              *ngIf=\"this.assignmentsByWeek[wIndex]?.length; else noAssignment\"\r\n            >\r\n              <div\r\n                *ngFor=\"let assignment of this.assignmentsByWeek[wIndex]\"\r\n                class=\"assignment-box\"\r\n                [ngClass]=\"{\r\n                  draggable: isEditMode,\r\n                  'alternate-color': assignment.position % 2 !== 0\r\n                }\"\r\n                cdkDrag\r\n                [cdkDragDisabled]=\"true\"\r\n              >\r\n                <app-assignment\r\n                  [assignment]=\"assignment\"\r\n                  [isEditMode]=\"isEditMode\"\r\n                  [listOfParts]=\"listOfParts\"\r\n                  [assignableListByPart]=\"assignableListByPart\"\r\n                  [form]=\"studentsForm\"\r\n                  [wIndex]=\"wIndex\"\r\n                  (isRemoved)=\"removeAssignment($event, wIndex)\"\r\n                ></app-assignment>\r\n              </div>\r\n            </ng-container>\r\n            <ng-template #noAssignment>\r\n              <div>{{ \"no-assignment\" | translate }}</div>\r\n            </ng-template>\r\n          </div>\r\n          <!--</div>-->\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n\r\n  <!-- <div *ngIf=\"payLoad\" class=\"form-row\">\r\n    <strong>Saved the following values</strong><br />\r\n    <pre>{{ payLoad }}</pre>\r\n  </div> -->\r\n</div>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}